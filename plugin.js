/*!
    * Author: MOHD AHSHAN DANISH
    * Email:  
    * Updated: 2025-10-06
    * @version 0.1.0
    */
!function(){"use strict";window.OfscPlugin=function(){this.init=function(t){this.tag=t,window.addEventListener("message",this._messageListener.bind(this),!1),this.sendPostMessageData({apiVersion:1,method:"ready",sendInitData:!0,showHeader:!0,enableBackButton:!0})},this.getOrigin=function(t){return""!=t?t.indexOf("://")>-1?"https://"+t.split("/")[2]:"https://"+t.split("/")[0]:""},this.getMetaAttributes=function(t){JSON.parse(window.localStorage.getItem(`${this.tag}_metadata`)||"{}")},this.customConfirm=function(t){return new Promise(e=>{const n=document.getElementById("custom-confirm");document.getElementById("confirm-message").textContent=t,n.style.display="flex",n.addEventListener("click",t=>{"confirm-ok"===t.target.id?(n.style.display="none",e(!0)):"confirm-cancel"===t.target.id&&(n.style.display="none",e(!1))})})},this.imagePreview=function(){const t=document.getElementById("uploadImage"),e=document.getElementById("imagePreview"),n=document.getElementById("previewImg");t.addEventListener("change",function(){const t=this.files[0];if(t&&t.type.startsWith("image/")){const i=new FileReader;i.onload=function(t){n.src=t.target.result,e.classList.remove("d-none")},i.readAsDataURL(t)}else n.src="",e.classList.add("d-none")})},this.prefillData=function(t){const e=document.getElementById("customerName"),n=document.getElementById("customerAddress");e&&(e.value=t.wo_account_name),n&&(n.value=t.mhn_customer_address)},this.open=async function(t){},this.sendPostMessageData=function(t){return this.isChannelBusy&&alert("Channel is busy. Please try again later."),new Promise((e,n)=>{this.callBackFunctionForPostMessage=async t=>{switch(console.error(`${this.tag} Recieved >>`,t.method),this.isChannelBusy=!1,t.method){case"init":window.localStorage.setItem(`${this.tag}_applictaion`,JSON.stringify(t.applications)),window.localStorage.setItem(`${this.tag}_metadata`,JSON.stringify(t.attributeDescription)),console.clear(),this.sendPostMessageData({apiVersion:1,method:"initEnd"});break;case"open":await this.activityValidation(t.activity),this.getJWTTokens(),this.open(t),this.getMetaAttributes(t),console.clear();break;case"error":alert(JSON.stringify(t.errors,void 0,"\t"));break;case"wakeup":this.wakeupReceived(t),console.clear()}e(t)},console.error(`${this.tag} Sent>>`,t.method),parent.postMessage(t,this.getOrigin(document.referrer))})},this.generateCallId=function(){return btoa(String.fromCharCode.apply(null,window.crypto.getRandomValues(new Uint8Array(16))))},this.getJWTTokens=function(){let t=window.localStorage.getItem(`${this.tag}_applictaion`);if(t){t=JSON.parse(t),this.jwtCallerId=this.generateCallId();for(let e in t){let n=t[e];if("ofs"===n.type){this.applictaionKey=e,this.applictaionURL=n.resourceUrl;break}}}},this._messageListener=function(t){try{const e=JSON.parse(t.data);this.callBackFunctionForPostMessage&&this.callBackFunctionForPostMessage(e)}catch(t){}}},window.addEventListener("load",function(){(new OfscPlugin).init("Suspend Activity")})}();
